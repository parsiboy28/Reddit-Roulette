{% extends "layout.html" %}

{% block body %}
<image_body>
   <div class="polaroid">
      <img alt="Image not loaded!" id="image_url">
      <div class="image_container">
         <h2 id="image_title"></h2>
      </div>

      <div class="button_container">
         <button id="previous_button"><i class="fas fa-arrow-left"></i></button>
         <button id="pause_button"><i class="fas fa-pause" id="pause_button_inside"></i></button>
         <button id="next_button"><i class="fas fa-arrow-right"></i></button>
      </div>
   </div>
   
   <h1 id="limit_reached">Image Limit Reached!</h1>

</image_body>
   
<!--modal-->
<div class="modal_container">
   <img class="modal_img"alt="img">
   <div class="modal_caption"></div>
</div>

   
   <script type="text/javascript">
      document.addEventListener("DOMContentLoaded", function(){
         let i = parseInt(sessionStorage.getItem("index") || "0");

         let images_json = {{ images | tojson | safe }};
         let image = images_json[i];

         document.querySelector("#previous_button").addEventListener("click", function(){
                    sessionStorage.setItem("index", i - 1);
                    location.reload();
         });
                document.querySelector("#next_button").addEventListener("click", function(){
                    sessionStorage.setItem("index", i + 1);
                    location.reload();
         });

         if (i == 0){
            document.querySelector("#previous_button").disabled = true;
            document.querySelector("#previous_button").style.opacity = 0.5;
         }
         if (i >= images_json.length){
            document.querySelector("#next_button").disabled = true;
            document.querySelector("#next_button").style.opacity = 0.5;
            document.querySelector("#pause_button").style.opacity = 0.5;
         }

         if (i < images_json.length){
            document.querySelector("#image_title").innerHTML = image.title;
            document.querySelector("#image_url").setAttribute("src", image.url);
            document.querySelector("#limit_reached").hidden = true;
            
            let timeout = setTimeout(function(){
               sessionStorage.setItem("index", i + 1);
               location.reload();
            }, 5000);

            let isPaused = false;

            document.querySelector("#pause_button").addEventListener("click", () => {
               const icon = document.querySelector("#pause_button_inside");

               if (!isPaused) {
                  clearTimeout(timeout);
                  icon.className = "fas fa-play";
                  isPaused = true;
               } 
               else {
                  // Restart auto-advance timeout
                  timeout = setTimeout(function(){
                     sessionStorage.setItem("index", i + 1);
                     location.reload();
                  }, 5000);

                     icon.className = "fas fa-pause";
                     isPaused = false;
                    }
            });

         }
         else{
            document.querySelector("#image_title").hidden = true;
            document.querySelector("#image_url").hidden = true;
            document.querySelector("#limit_reached").hidden = false;
         }
         

         //modal script
         var modalContainer = document.querySelector(".modal_container");
         var modalImg = document.querySelector(".modal_img");
         var modalCaption = document.querySelector(".modal_caption");

         

         document.querySelector("#image_url").addEventListener("click", ()=>{
            modalImg.src = document.querySelector("#image_url").src;
            modalCaption.innerHTML = document.querySelector("#image_title").innerHTML;
            modalContainer.style.display = "flex";
            modalImg.style.animation = "zoom_in 0.6s";
            modalCaption.style.animation = "zoom_in 0.6s";
         })
         
         modalContainer.addEventListener("click", ()=>{
            modalImg.style.animation = "zoom_out 0.6s";
            modalCaption.style.animation = "zoom_out 0.6s";
            setTimeout(()=>{
               modalContainer.style.display = "none";
            }, 400);
            
         })

      });
   </script>

{% endblock %}